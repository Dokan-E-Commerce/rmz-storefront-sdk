# üõ°Ô∏è RMZ Storefront SDK

[![npm version](https://badge.fury.io/js/%40rmz%2Fstorefront-sdk.svg)](https://badge.fury.io/js/%40rmz%2Fstorefront-sdk)
[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=flat&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Security](https://img.shields.io/badge/Security-HMAC--SHA256-green)](https://tools.ietf.org/html/rfc2104)
[![Framework Agnostic](https://img.shields.io/badge/Framework-Agnostic-purple)](https://github.com/rmz/storefront-sdk)

A **secure**, **framework-agnostic** SDK for the RMZ Storefront API. Works seamlessly with React, Vue, Angular, Svelte, Vanilla JS, and Node.js environments.

## ‚ú® Features

- üîí **Enterprise-grade Security**: HMAC-SHA256 authentication with automatic signature generation
- üåç **Universal Compatibility**: Works in browsers, Node.js, Web Workers, and any JavaScript environment
- üéØ **Framework Agnostic**: Use with React, Vue, Angular, Svelte, or Vanilla JS
- üî• **Firebase/Supabase-style API**: Intuitive method chaining for complex queries
- üì± **Client & Server-side**: Secure operation in both environments
- üöÄ **TypeScript First**: Full type safety and IntelliSense support
- ‚ö° **Performance Optimized**: Automatic retry, caching, and request deduplication
- üõ°Ô∏è **Security Focused**: No sensitive data exposure, automatic sanitization

## üöÄ Quick Start

### Installation

```bash
npm install @rmz/storefront-sdk
# or
yarn add @rmz/storefront-sdk
# or
pnpm add @rmz/storefront-sdk
```

### Basic Usage

```typescript
import { createStorefrontSDK } from '@rmz/storefront-sdk';

// Initialize the SDK
const sdk = createStorefrontSDK({
  apiUrl: 'https://your-store.rmz.gg/api/storefront',
  publicKey: 'pk_your_public_key_here',
  // secretKey: 'sk_secret_key_here', // Only for server-side
  environment: 'production'
});

// Get store information
const store = await sdk.store.get();

// Firebase/Supabase-style queries
const featuredProducts = await sdk.products
  .where('featured', '=', true)
  .orderBy('created_at', 'desc')
  .limit(8)
  .get();

// Add to cart
const cart = await sdk.cart.addItem(productId, 2);
```

## üéØ Framework Examples

### React

```jsx
import { useStorefrontSDK } from '@rmz/storefront-sdk';
import { useEffect, useState } from 'react';

function ProductList() {
  const sdk = useStorefrontSDK({
    apiUrl: process.env.NEXT_PUBLIC_API_URL,
    publicKey: process.env.NEXT_PUBLIC_PUBLIC_KEY,
  });

  const [products, setProducts] = useState([]);

  useEffect(() => {
    async function loadProducts() {
      const { data } = await sdk.products.getAll({ per_page: 12 });
      setProducts(data);
    }
    loadProducts();
  }, [sdk]);

  return (
    <div>
      {products.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  );
}
```

### Vue 3

```vue
<script setup>
import { useStorefront } from '@rmz/storefront-sdk';
import { ref, onMounted } from 'vue';

const sdk = useStorefront({
  apiUrl: import.meta.env.VITE_API_URL,
  publicKey: import.meta.env.VITE_PUBLIC_KEY,
});

const products = ref([]);

onMounted(async () => {
  const { data } = await sdk.value.products.getAll();
  products.value = data;
});
</script>

<template>
  <div>
    <div v-for="product in products" :key="product.id">
      {{ product.name }}
    </div>
  </div>
</template>
```

### Angular

```typescript
import { Injectable } from '@angular/core';
import { createStorefrontSDK, type SecureStorefrontSDK } from '@rmz/storefront-sdk';

@Injectable({
  providedIn: 'root'
})
export class StorefrontService {
  private sdk: SecureStorefrontSDK;

  constructor() {
    this.sdk = createStorefrontSDK({
      apiUrl: environment.apiUrl,
      publicKey: environment.publicKey,
    });
  }

  async getProducts() {
    return this.sdk.products.getAll();
  }

  async addToCart(productId: number, quantity: number) {
    return this.sdk.cart.addItem(productId, quantity);
  }
}
```

### Vanilla JavaScript

```html
<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/@rmz/storefront-sdk@latest/dist/index.umd.js"></script>
</head>
<body>
  <script>
    const { createStorefrontSDK } = RMZStorefront;

    const sdk = createStorefrontSDK({
      apiUrl: 'https://your-store.rmz.gg/api/storefront',
      publicKey: 'pk_your_public_key_here'
    });

    async function loadProducts() {
      const products = await sdk.products.getFeatured(8);
      console.log('Featured products:', products);
    }

    loadProducts();
  </script>
</body>
</html>
```

### Node.js (Server-side)

```javascript
const { createStorefrontSDK } = require('@rmz/storefront-sdk');

const sdk = createStorefrontSDK({
  apiUrl: 'https://your-store.rmz.gg/api/storefront',
  publicKey: process.env.RMZ_PUBLIC_KEY,
  secretKey: process.env.RMZ_SECRET_KEY, // Server-side only
  environment: 'production'
});

// Server-side operations with full HMAC security
async function getStoreData() {
  const store = await sdk.store.get();
  const products = await sdk.products.getAll({ per_page: 100 });
  return { store, products };
}
```

## üî• Firebase/Supabase-style Queries

The SDK provides an intuitive query builder similar to Firebase and Supabase:

```typescript
// Complex queries with method chaining
const expensiveProducts = await sdk.products
  .where('price', '>', 100)
  .where('category', '=', 'electronics')
  .orderBy('price', 'desc')
  .limit(10)
  .get();

// Search with filters
const searchResults = await sdk.products.search('laptop', {
  category: 'electronics',
  price_min: 500,
  price_max: 2000,
  per_page: 20
});

// Category products
const categoryProducts = await sdk.categories
  .getProducts('electronics', {
    sort: 'price_asc',
    per_page: 12
  });
```

## üõ°Ô∏è Security Features

### Automatic HMAC Authentication

The SDK automatically handles HMAC-SHA256 signature generation and verification:

```typescript
// Client-side (browser) - automatic public key authentication
const sdk = createStorefrontSDK({
  apiUrl: 'https://api.example.com',
  publicKey: 'pk_public_key_here' // Only public key needed
});

// Server-side (Node.js) - full HMAC security
const sdk = createStorefrontSDK({
  apiUrl: 'https://api.example.com',
  publicKey: 'pk_public_key_here',
  secretKey: 'sk_secret_key_here' // Enables HMAC signatures
});
```

### Environment Detection

The SDK automatically detects the environment and applies appropriate security measures:

```typescript
import { Environment } from '@rmz/storefront-sdk';

console.log(Environment.info);
// {
//   isServer: false,
//   isBrowser: true,
//   isWebWorker: false,
//   isNode: false,
//   platform: 'browser'
// }
```

### Data Sanitization

All API responses are automatically sanitized to prevent sensitive data exposure:

```typescript
// Sensitive fields are automatically removed from client-side responses
const customer = await sdk.auth.getProfile();
// Fields like 'password', 'secret_key', 'api_token' are never exposed
```

## üìö API Reference

### Store API

```typescript
// Get store information
const store = await sdk.store.get();

// Get available currencies
const currencies = await sdk.store.getCurrencies();

// Change currency
await sdk.store.changeCurrency('USD');

// Get store settings
const settings = await sdk.store.getSettings();
```

### Products API

```typescript
// Get all products with pagination
const { data, pagination } = await sdk.products.getAll({
  page: 1,
  per_page: 12,
  category: 'electronics',
  sort: 'price_asc'
});

// Get single product
const product = await sdk.products.getBySlug('product-slug');

// Search products
const { data } = await sdk.products.search('laptop', {
  price_min: 500,
  price_max: 2000
});

// Get featured products
const featured = await sdk.products.getFeatured(8);

// Get related products
const related = await sdk.products.getRelated(productId, 4);

// Get product reviews
const { data: reviews } = await sdk.products.getReviews(productId);
```

### Cart API

```typescript
// Get current cart
const cart = await sdk.cart.get();

// Add item to cart
const updatedCart = await sdk.cart.addItem(productId, 2, {
  fields: { color: 'red', size: 'L' },
  notice: 'Special instructions'
});

// Update item quantity
await sdk.cart.updateItem(itemId, 3);

// Remove item
await sdk.cart.removeItem(itemId);

// Apply coupon
await sdk.cart.applyCoupon('DISCOUNT10');

// Get cart count
const count = await sdk.cart.getCount();

// Clear cart
await sdk.cart.clear();
```

### Authentication API

```typescript
// Start phone authentication
const { session_token } = await sdk.auth.startPhoneAuth('+1234567890', 'US');

// Verify OTP
const { token, customer } = await sdk.auth.verifyOTP('123456', session_token);

// Complete registration
const { token, customer } = await sdk.auth.completeRegistration({
  firstName: 'John',
  lastName: 'Doe',
  email: 'john@example.com',
  sessionToken: session_token
});

// Get profile
const profile = await sdk.auth.getProfile();

// Update profile
await sdk.auth.updateProfile({ firstName: 'Jane' });

// Logout
await sdk.auth.logout();
```

### Orders API

```typescript
// Get customer orders
const { data: orders } = await sdk.orders.getAll({ page: 1 });

// Get specific order
const order = await sdk.orders.getById(orderId);
```

### Checkout API

```typescript
// Create checkout session
const { checkout_url, session_id } = await sdk.checkout.create();

// Get checkout result
const { status, order } = await sdk.checkout.getResult(session_id);
```

### Wishlist API

```typescript
// Get wishlist
const { items, count } = await sdk.wishlist.get();

// Add to wishlist
await sdk.wishlist.addItem(productId);

// Remove from wishlist
await sdk.wishlist.removeItem(productId);

// Check if in wishlist
const { in_wishlist } = await sdk.wishlist.check(productId);

// Clear wishlist
await sdk.wishlist.clear();
```

## ‚öôÔ∏è Configuration

### Full Configuration Options

```typescript
interface StorefrontConfig {
  apiUrl: string;              // API base URL
  publicKey: string;           // Public key for authentication
  secretKey?: string;          // Secret key (server-side only)
  environment?: 'production' | 'development';
  version?: string;            // API version
  timeout?: number;            // Request timeout (ms)
  maxRetries?: number;         // Maximum retry attempts
  retryDelay?: number;         // Delay between retries (ms)
  enableLogging?: boolean;     // Enable debug logging
}
```

### Environment Variables

For security, use environment variables:

```bash
# Client-side (Next.js, Vite, etc.)
NEXT_PUBLIC_RMZ_API_URL=https://your-store.rmz.gg/api/storefront
NEXT_PUBLIC_RMZ_PUBLIC_KEY=pk_your_public_key

# Server-side (Node.js)
RMZ_API_URL=https://your-store.rmz.gg/api/storefront
RMZ_PUBLIC_KEY=pk_your_public_key
RMZ_SECRET_KEY=sk_your_secret_key
```

## üîß Advanced Usage

### Custom HTTP Headers

```typescript
// The SDK automatically handles security headers
// But you can access the underlying HTTP client for custom requests
import { SecurityManager, UniversalHttpClient } from '@rmz/storefront-sdk';

const security = new SecurityManager({
  publicKey: 'your_public_key',
  secretKey: 'your_secret_key' // server-side only
});

const httpClient = new UniversalHttpClient({
  baseUrl: 'https://api.example.com',
  timeout: 30000
}, security);
```

### Error Handling

```typescript
try {
  const products = await sdk.products.getAll();
} catch (error) {
  if (error.message.includes('401')) {
    // Handle authentication error
    console.error('Authentication failed');
  } else if (error.message.includes('429')) {
    // Handle rate limit
    console.error('Rate limit exceeded');
  } else {
    // Handle other errors
    console.error('API error:', error.message);
  }
}
```

### Health Check

```typescript
// Check API connectivity and authentication
const health = await sdk.healthCheck();
if (health.status === 'ok') {
  console.log('API is healthy');
} else {
  console.error('API error:', health.message);
}
```

### SDK Information

```typescript
// Get SDK version and environment info
const info = sdk.getInfo();
console.log('SDK Version:', info.version);
console.log('Environment:', info.environment.platform);
console.log('Config:', info.config);
```

## üîí Security Best Practices

### 1. Environment Separation

```typescript
// ‚úÖ Good: Separate configs for client/server
const clientConfig = {
  apiUrl: process.env.NEXT_PUBLIC_API_URL,
  publicKey: process.env.NEXT_PUBLIC_PUBLIC_KEY, // Client-side safe
};

const serverConfig = {
  apiUrl: process.env.API_URL,
  publicKey: process.env.PUBLIC_KEY,
  secretKey: process.env.SECRET_KEY, // Server-side only
};
```

### 2. Key Management

```typescript
// ‚ùå Bad: Exposing secret key on client-side
const sdk = createStorefrontSDK({
  apiUrl: 'https://api.example.com',
  publicKey: 'pk_public',
  secretKey: 'sk_secret' // üö® NEVER do this in browser!
});

// ‚úÖ Good: Only public key on client-side
const sdk = createStorefrontSDK({
  apiUrl: 'https://api.example.com',
  publicKey: 'pk_public' // Safe for browser
});
```

### 3. HTTPS Only

```typescript
// ‚úÖ Always use HTTPS in production
const sdk = createStorefrontSDK({
  apiUrl: 'https://your-secure-api.com', // HTTPS required
  publicKey: 'pk_your_key',
  environment: 'production'
});
```

## üöÄ Performance Tips

### 1. Singleton Pattern

```typescript
// ‚úÖ Create once, use everywhere
const sdk = createStorefrontSDK(config); // Uses singleton internally

// ‚úÖ Or use React hook for automatic memoization
const sdk = useStorefrontSDK(config);
```

### 2. Pagination

```typescript
// ‚úÖ Use pagination for large datasets
const { data, pagination } = await sdk.products.getAll({
  per_page: 20, // Reasonable page size
  page: 1
});
```

### 3. Caching

```typescript
// The SDK automatically handles caching and deduplication
// Multiple identical requests are automatically deduplicated
const promise1 = sdk.products.getFeatured();
const promise2 = sdk.products.getFeatured(); // Same request, reused
const [result1, result2] = await Promise.all([promise1, promise2]);
```

## üì± Mobile & React Native

The SDK works seamlessly with React Native:

```typescript
import { createStorefrontSDK } from '@rmz/storefront-sdk';

const sdk = createStorefrontSDK({
  apiUrl: 'https://your-api.com',
  publicKey: 'pk_your_key',
});

// Use normally in React Native components
function ProductScreen() {
  const [product, setProduct] = useState(null);

  useEffect(() => {
    sdk.products.getBySlug('product-slug').then(setProduct);
  }, []);

  return product ? <Text>{product.name}</Text> : <Text>Loading...</Text>;
}
```

## üß™ Testing

```typescript
// Mock the SDK for testing
jest.mock('@rmz/storefront-sdk', () => ({
  createStorefrontSDK: () => ({
    products: {
      getAll: jest.fn().mockResolvedValue({ data: [] }),
      getFeatured: jest.fn().mockResolvedValue([]),
    },
    cart: {
      addItem: jest.fn().mockResolvedValue({ items: [] }),
    }
  })
}));
```

## üìä Bundle Size

The SDK is optimized for minimal bundle size:

- **Core SDK**: ~15KB gzipped
- **Tree-shakeable**: Import only what you need
- **Zero dependencies**: No external runtime dependencies
- **Universal build**: Works everywhere without polyfills

## ü§ù Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

## üìÑ License

MIT License - see [LICENSE](LICENSE) file for details.

## üîó Links

- [Documentation](https://docs.rmz.gg/storefront-sdk)
- [API Reference](https://api-docs.rmz.gg)
- [GitHub](https://github.com/rmz/storefront-sdk)
- [Issues](https://github.com/rmz/storefront-sdk/issues)
- [Security Policy](SECURITY.md)

## üìû Support

- üìß Email: support@rmz.gg
- üí¨ Discord: [Join our community](https://discord.gg/rmz)
- üìñ Documentation: [docs.rmz.gg](https://docs.rmz.gg)

---

Made with ‚ù§Ô∏è by the RMZ Team