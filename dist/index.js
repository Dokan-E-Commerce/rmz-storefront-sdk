"use strict";var w=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var C=(c,t)=>{for(var e in t)w(c,e,{get:t[e],enumerable:!0})},k=(c,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of S(t))!T.call(c,r)&&r!==e&&w(c,r,{get:()=>t[r],enumerable:!(s=v(t,r))||s.enumerable});return c};var A=c=>k(w({},"__esModule",{value:!0}),c);var _={};C(_,{Environment:()=>o,SecureStorefrontSDK:()=>g,SecurityManager:()=>p,UniversalHttpClient:()=>d,createStorefrontSDK:()=>m,default:()=>g,useStorefront:()=>P,useStorefrontSDK:()=>R});module.exports=A(_);var o=class{static get info(){return this._info||(this._info=this.detect()),this._info}static detect(){let t=typeof window<"u"&&typeof window.document<"u"&&typeof window.navigator<"u",e=typeof globalThis.importScripts=="function"&&typeof globalThis.navigator<"u"&&!t,s=!t&&typeof process<"u"&&process.versions&&!!process.versions.node,r=s,n="unknown";return s?n="node":t?n="browser":e&&(n="webworker"),{isServer:r,isBrowser:t,isWebWorker:e,isNode:s,platform:n}}static getEnvVar(t){if(!this.info.isServer){console.warn(`Environment variable access attempted in ${this.info.platform} environment. Use configuration object instead.`);return}if(typeof process<"u"&&process.env)return process.env[t]}static canUseSecureFeatures(){return this.info.isServer||this.info.isBrowser&&typeof globalThis.window<"u"&&globalThis.window.isSecureContext}static getCrypto(){if(this.info.isServer&&typeof require<"u")try{return require("crypto")}catch{return null}return this.info.isBrowser&&typeof globalThis.window<"u"&&globalThis.window.crypto&&globalThis.window.crypto.subtle?globalThis.window.crypto:null}static hasFetch(){return typeof fetch<"u"}static getHttpClient(){if(this.hasFetch())return fetch;throw new Error("Fetch is not available. This should not happen in a Next.js environment.")}};o._info=null;var p=class{constructor(t){this.config={...t,signatureVersion:t.signatureVersion||"v1",timestampTolerance:t.timestampTolerance||300},this.validateConfig()}setAuthToken(t){this.config.authToken=t||void 0}getAuthToken(){return this.config.authToken}setCartToken(t){this.config.cartToken=t||void 0}getCartToken(){return this.config.cartToken}validateConfig(){if(!this.config.publicKey)throw new Error("Public key is required");if(o.info.isServer&&!this.config.secretKey)throw new Error("Secret key is required for server-side operations");o.info.isBrowser&&this.config.secretKey&&console.warn("Secret key detected in browser environment. This is a security risk!")}async generateSignature(t,e,s,r=""){if(!o.info.isServer)throw new Error("Signature generation is only available server-side");if(!this.config.secretKey)throw new Error("Secret key required for signature generation");let n=o.getCrypto();if(!n)throw new Error("Crypto module not available");let a=[this.config.signatureVersion,t,e.toUpperCase(),s,this.hashString(r,n)].join(`
`),i=n.createHmac("sha256",this.config.secretKey);return i.update(a),i.digest("hex")}async verifySignature(t,e,s,r,n=""){if(!o.info.isServer)throw new Error("Signature verification is only available server-side");let a=Math.floor(Date.now()/1e3),i=parseInt(e);if(Math.abs(a-i)>this.config.timestampTolerance)return!1;try{let u=await this.generateSignature(e,s,r,n);return this.constantTimeCompare(t,u)}catch{return!1}}getAuthHeaders(t,e,s=""){let r=Math.floor(Date.now()/1e3).toString(),n={"X-Public-Key":this.config.publicKey,"X-Timestamp":r,"X-Signature-Version":this.config.signatureVersion};if(this.config.authToken&&(n.Authorization=`Bearer ${this.config.authToken}`),this.config.cartToken&&(n["X-Cart-Token"]=this.config.cartToken),this.config.secretKey)try{if(o.info.isServer){let a=this.generateSignatureSync(r,t,e,s);n["X-Signature"]=a}else if(o.info.isBrowser){let a=this.generateBrowserSignature(r,t,e,s);n["X-Signature"]=a}}catch(a){console.warn("Failed to generate signature:",a),n["X-Client-Auth"]="true"}else n["X-Client-Auth"]="true";return n}generateSignatureSync(t,e,s,r=""){if(!o.info.isServer||!this.config.secretKey)throw new Error("Synchronous signature generation requires server environment and secret key");let n=o.getCrypto();if(!n)throw new Error("Crypto module not available");let a=[this.config.signatureVersion,t,e.toUpperCase(),s,n.createHash("sha256").update(r).digest("hex")].join(`
`);return n.createHmac("sha256",this.config.secretKey).update(a).digest("hex")}hashString(t,e){return o.info.isServer?e.createHash("sha256").update(t).digest("hex"):t}generateBrowserSignature(t,e,s,r=""){if(!this.config.secretKey)throw new Error("Secret key required for signature generation");let n=this.sha256(r),a=[this.config.signatureVersion,t,e.toUpperCase(),s,n].join(`
`);return this.hmacSha256(a,this.config.secretKey)}sha256(t){return t?require("crypto-js/sha256")(t).toString():"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"}hmacSha256(t,e){return require("crypto-js").HmacSHA256(t,e).toString()}constantTimeCompare(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t.charCodeAt(r)^e.charCodeAt(r);return s===0}sanitizeClientData(t){if(Array.isArray(t))return t.map(e=>this.sanitizeClientData(e));if(t&&typeof t=="object"){let e={},s=["password","secret","key","token","api_key","private_key","secret_key","webhook_secret","email_verified_at","remember_token","deleted_at","created_by","updated_by","deleted_by"],r=["session_token","csrf_token","access_token","refresh_token","token"];for(let[n,a]of Object.entries(t)){let i=n.toLowerCase(),u=r.some(y=>i===y);!u&&s.some(y=>i.includes(y)||i.endsWith("_secret")||i.endsWith("_token"))?console.log(`\u{1F6AB} SecurityManager: Filtering out sensitive field: ${n} (isAllowedToken: ${u})`):e[n]=this.sanitizeClientData(a)}return e}return t}generateSecureRandom(t=32){let e=o.getCrypto();if(o.info.isServer&&e)return e.randomBytes(t).toString("hex");if(o.info.isBrowser&&e&&e.getRandomValues){let s=new Uint8Array(t);return e.getRandomValues(s),Array.from(s,r=>r.toString(16).padStart(2,"0")).join("")}return console.warn("Using fallback random generation - not cryptographically secure"),Math.random().toString(36).substring(2)+Date.now().toString(36)}validateResponse(t){return!t||typeof t!="object"||t.success!==void 0&&typeof t.success!="boolean"?!1:(t.data!==void 0&&t.data!==null&&(t.data=this.sanitizeClientData(t.data)),!0)}};var d=class{constructor(t,e){this.config={timeout:3e4,maxRetries:2,retryDelay:500,headers:{"Content-Type":"application/json",Accept:"application/json"},...t,baseUrl:t.baseUrl||""},this.security=e}async request(t){let e=this.buildUrl(t.url),s=t.data?JSON.stringify(t.data):"",r=this.security.getAuthHeaders(t.method,new URL(e).pathname,s),n={...this.config.headers,...r,...t.headers};o.info.isNode&&(n["User-Agent"]=`StorefrontSDK/1.0 (${o.info.platform})`);let a;for(let i=0;i<=this.config.maxRetries;i++)try{let u=await this.makeRequest({...t,url:e,headers:n},s);if(!this.security.validateResponse(u.data))throw new Error("Invalid response format");return u}catch(u){if(a=u,this.shouldNotRetry(u)||i===this.config.maxRetries)break;let l=this.config.retryDelay*Math.pow(2,i);if((u.status||u.response?.status)===429){let h=u.response?.headers?.["retry-after"];if(h){let b=isNaN(h)?new Date(h).getTime()-Date.now():parseInt(h)*1e3;b>0&&b<6e4&&(l=b)}}await this.delay(l)}throw a}async makeRequest(t,e){let s=t.timeout||this.config.timeout;if(o.info.isBrowser||o.hasFetch())return this.fetchRequest(t,e,s);if(o.info.isNode)return this.nodeRequest(t,e,s);throw new Error("No HTTP client available for this environment")}async fetchRequest(t,e,s){let r=new AbortController,n=setTimeout(()=>r.abort(),s);try{let a={method:t.method,headers:t.headers,signal:r.signal};t.method!=="GET"&&(a.body=e);let i=await fetch(t.url,a);clearTimeout(n);let u=await this.parseResponse(i);if(!i.ok)throw{message:u.message||`HTTP ${i.status}: ${i.statusText}`,response:{data:u,status:i.status,statusText:i.statusText,headers:this.extractHeaders(i.headers)},status:i.status,name:"HttpError"};return{data:u,status:i.status,statusText:i.statusText,headers:this.extractHeaders(i.headers)}}catch(a){throw clearTimeout(n),this.normalizeError(a)}}async nodeRequest(t,e,s){let r=o.getHttpClient();if(r.default){let n=r.default;try{let a=await n({method:t.method,url:t.url,data:t.method!=="GET"?JSON.parse(e||"{}"):void 0,headers:t.headers,timeout:s});return{data:a.data,status:a.status,statusText:a.statusText,headers:a.headers}}catch(a){throw this.normalizeError(a)}}else return this.fetchRequest(t,e,s)}async parseResponse(t){let e=t.headers.get("content-type")||"";return e.includes("application/json")?t.json():e.includes("text/")?t.text():t.blob()}extractHeaders(t){let e={};return t instanceof Headers?t.forEach((s,r)=>{e[r]=s}):Object.assign(e,t),e}buildUrl(t){if(t.startsWith("http://")||t.startsWith("https://"))return t;let e=this.config.baseUrl.replace(/\/$/,""),s=t.startsWith("/")?t:`/${t}`;return`${e}${s}`}shouldNotRetry(t){let e=t.status||t.response?.status;if(e){if(e>=400&&e<500)return!(e===408||e===429);if(e===501||e===505)return!0}return["ENOTFOUND","ECONNREFUSED","CERT_","ABORT_ERR"].some(r=>t.message?.includes(r))}normalizeError(t){return t.response&&t.response.data?t:t.response?{message:`HTTP ${t.response.status}: ${t.response.statusText}`,response:t.response,status:t.response.status,name:"HttpError"}:t.status?{message:`HTTP ${t.status}: ${t.statusText}`,status:t.status,name:"HttpError"}:t instanceof Error&&(t.name==="TypeError"||t.name==="NetworkError")?t:{message:String(t),name:"UnknownError"}}delay(t){return new Promise(e=>setTimeout(e,t))}async get(t,e,s){let r=t;if(e&&Object.keys(e).length>0){let n=new URLSearchParams;for(let[i,u]of Object.entries(e))u!=null&&u!==""&&n.append(i,String(u));let a=n.toString();a&&(r+=(t.includes("?")?"&":"?")+a)}return this.request({method:"GET",url:r,headers:s})}async post(t,e,s){return this.request({method:"POST",url:t,data:e,headers:s})}async put(t,e,s){return this.request({method:"PUT",url:t,data:e,headers:s})}async patch(t,e,s){return this.request({method:"PATCH",url:t,data:e,headers:s})}async delete(t,e){return this.request({method:"DELETE",url:t,headers:e})}};var f=class f{constructor(t){this.config={environment:"production",version:"1.0.0",timeout:3e4,maxRetries:3,retryDelay:1e3,enableLogging:!1,...t},this.security=new p({publicKey:this.config.publicKey,secretKey:this.config.secretKey,signatureVersion:"v1",timestampTolerance:300}),this.http=new d({baseUrl:this.config.apiUrl,timeout:this.config.timeout,maxRetries:this.config.maxRetries,retryDelay:this.config.retryDelay},this.security),this.log("SDK initialized",{environment:o.info.platform})}setAuthToken(t){this.security.setAuthToken(t),this.log("Auth token updated",{hasToken:!!t})}getAuthToken(){return this.security.getAuthToken()}setCartToken(t){this.security.setCartToken(t),this.log("Cart token updated",{hasToken:!!t})}getCartToken(){return this.security.getCartToken()}static createInstance(t){let e=`${t.apiUrl}_${t.publicKey}`;return this.instances.has(e)||this.instances.set(e,new f(t)),this.instances.get(e)}get store(){return{get:async t=>{let e=await this.http.get("/store",{"X-Include":t?.include?.join(",")||""});return e.data.data||e.data},getCurrencies:async()=>{let t=await this.http.get("/store/currencies");return t.data.data||t.data},changeCurrency:async t=>{await this.http.post("/store/currency",{symbol:t})},getSettings:async()=>{let t=await this.http.get("/store/settings");return t.data.data||t.data},getFeatures:async()=>{let t=await this.http.get("/store/features");return t.data.data||t.data},getBanners:async()=>{let t=await this.http.get("/store/banners");return t.data.data||t.data}}}get products(){return{where:(t,e,s)=>({orderBy:(r,n="asc")=>({limit:a=>({get:async()=>{let i=this.buildProductParams({field:t,operator:e,value:s},r,n,a),u=await this.http.get("/products",i);return u.data.data||u.data}}),get:async()=>{let a=this.buildProductParams({field:t,operator:e,value:s},r,n),i=await this.http.get("/products",a);return i.data.data||i.data}}),get:async()=>{let r=this.buildProductParams({field:t,operator:e,value:s}),n=await this.http.get("/products",r);return n.data.data||n.data}}),getAll:async t=>{let e=await this.http.get("/products",t);return{data:e.data.data,pagination:e.data.pagination}},getById:async t=>{let e=await this.http.get(`/products/${t}`);return e.data.data||e.data},getBySlug:async t=>{let e=await this.http.get(`/products/${t}`);return e.data.data||e.data},search:async(t,e)=>{let s=await this.http.get("/products/search",{q:t,...e});return{data:s.data.data,pagination:s.data.pagination}},getFeatured:async(t=8)=>{let e=await this.http.get("/featured-products",{limit:t});return e.data.data||e.data},getRelated:async(t,e=4)=>{let s=await this.http.get(`/products/${t}/related`,{limit:e});return s.data.data||s.data},getReviews:async(t,e)=>{let s=await this.http.get(`/products/${t}/reviews`,e);return{data:s.data.data,pagination:s.data.pagination}}}}get categories(){return{getAll:async()=>{let t=await this.http.get("/categories");return t.data.data||t.data},getById:async t=>{let e=await this.http.get(`/categories/${t}`);return e.data.data||e.data},getBySlug:async t=>{let e=await this.http.get(`/categories/${t}`);return e.data.data||e.data},getProducts:async(t,e)=>{let s=await this.http.get(`/categories/${t}/products`,e);return{data:s.data.data,pagination:s.data.pagination}}}}handleCartResponse(t){if(!t)throw new Error("No response data from server.");if(t.success===!1&&t.message)throw new Error(t.message);return t.cart_token&&this.setCartToken(t.cart_token),t}get cart(){return{get:async()=>{let t=await this.http.get("/cart");return this.handleCartResponse(t.data.data)},addItem:async(t,e=1,s)=>{let r=await this.http.post("/cart/add",{product_id:t,qty:e,...s});return this.handleCartResponse(r.data.data)},updateItem:async(t,e)=>{let s=await this.http.patch(`/cart/items/${t}`,{quantity:e});return this.handleCartResponse(s.data.data)},removeItem:async t=>{let e=await this.http.delete(`/cart/items/${t}`);return this.handleCartResponse(e.data.data)},clear:async()=>{await this.http.delete("/cart/clear"),this.setCartToken(null)},getCount:async()=>{let t=await this.http.get("/cart/count");return t.data.data.cart_token&&this.setCartToken(t.data.data.cart_token),t.data.data.count},applyCoupon:async t=>{let e=await this.http.post("/cart/coupon",{coupon:t});return this.handleCartResponse(e.data.data)},removeCoupon:async()=>{let t=await this.http.delete("/cart/coupon");return this.handleCartResponse(t.data.data)},validate:async()=>{let t=await this.http.get("/cart/validate");return t.data.data||t.data},getSummary:async()=>{let t=await this.http.get("/cart/summary");return t.data.data||t.data}}}get auth(){return{startPhoneAuth:async(t,e)=>{let s=await this.http.post("/auth/phone/start",{phone:t,country_code:e});console.log("SecureSDK: startPhoneAuth full response:",s),console.log("SecureSDK: response.data:",s.data),console.log("SecureSDK: response.data.data:",s.data.data);let r=s.data;return console.log("SecureSDK: responseData keys:",Object.keys(r)),console.log("SecureSDK: responseData.data:",r.data),console.log("SecureSDK: responseData.data keys:",r.data?Object.keys(r.data):"undefined"),r.data&&r.data.session_token?(console.log("SecureSDK: Found session_token:",r.data.session_token),{session_token:r.data.session_token}):(console.error("SecureSDK: Could not find session_token in response"),r)},verifyOTP:async(t,e)=>{let s={code:t,session_token:e};console.log("SecureSDK: verifyOTP request body:",s);let r=await this.http.post("/auth/phone/verify",s);return console.log("\u{1F50D} SecureSDK: Raw API response before sanitization:",JSON.stringify(r.data,null,2)),console.log("\u{1F50D} SecureSDK: Extracted data (response.data.data):",JSON.stringify(r.data.data,null,2)),r.data.data||r.data},resendOTP:async t=>{let e={session_token:t};console.log("SecureSDK: resendOTP request body:",e),await this.http.post("/auth/phone/resend",e)},completeRegistration:async t=>{let e=await this.http.post("/auth/complete",{firstName:t.firstName,lastName:t.lastName,email:t.email,session_token:t.sessionToken});return e.data.data||e.data},getProfile:async()=>{let t=await this.http.get("/customer/profile");return t.data.data||t.data},updateProfile:async t=>{let e=await this.http.patch("/customer/profile",t);return e.data.data||e.data},logout:async()=>{await this.http.post("/customer/logout")}}}get orders(){return{getAll:async t=>{let e=await this.http.get("/customer/orders",t);return{data:e.data.data,pagination:e.data.pagination}},getById:async t=>{let e=await this.http.get(`/customer/orders/${t}`);return e.data.data||e.data},getCourses:async()=>{let t=await this.http.get("/customer/courses");return t.data.data||t.data},getSubscriptions:async()=>{let t=await this.http.get("/customer/subscriptions");return t.data.data||t.data},submitReview:async(t,e)=>{let s=await this.http.post(`/orders/${t}/review`,e);return s.data.data||s.data}}}get checkout(){return{create:async()=>{let t=await this.http.post("/checkout");return t.data.data||t.data},getResult:async t=>{let e=await this.http.get(`/checkout/${t}/result`);return e.data.data||e.data}}}get wishlist(){return{get:async()=>{let t=await this.http.get("/wishlist");return t.data.data||t.data},addItem:async t=>{await this.http.post("/wishlist",{product_id:t})},removeItem:async t=>{await this.http.delete(`/wishlist/${t}`)},check:async t=>{let e=await this.http.get(`/wishlist/check/${t}`);return e.data.data||e.data},clear:async()=>{await this.http.delete("/wishlist/clear")}}}get reviews(){return{getAll:async t=>{let e=await this.http.get("/reviews",t);return{data:e.data.data,pagination:e.data.pagination}},getRecent:async(t=6)=>{let e=await this.http.get("/reviews/recent",{limit:t});return e.data.data||e.data},submit:async(t,e)=>{let s=await this.http.post(`/products/${t}/reviews`,e);return s.data.data||s.data},getStats:async()=>{let t=await this.http.get("/reviews/stats");return t.data.data||t.data}}}get components(){return{getAll:async()=>{let t=await this.http.get("/components");return t.data.data||t.data},getById:async t=>{let e=await this.http.get(`/components/${t}`);return e.data.data||e.data},getProducts:async(t,e)=>{let s=await this.http.get(`/components/${t}/products`,e);return{data:s.data.data,pagination:s.data.pagination}}}}get pages(){return{getAll:async()=>{let t=await this.http.get("/pages");return t.data.data||t.data},getByUrl:async t=>{let e=await this.http.get(`/pages/${t}`);return e.data.data||e.data}}}get courses(){return{getAll:async t=>{let e=await this.http.get("/courses",t);return{data:e.data.data,pagination:e.data.pagination}},getById:async t=>{let e=await this.http.get(`/courses/${t}`);return e.data.data||e.data},getProgress:async t=>{let e=await this.http.get(`/courses/${t}/progress`);return e.data.data||e.data},getModule:async(t,e)=>{let s=await this.http.get(`/courses/${t}/modules/${e}`);return s.data.data||s.data},completeModule:async(t,e)=>{let s=await this.http.post(`/courses/${t}/modules/${e}/complete`);return s.data.data||s.data},getCustomerCourses:async()=>{let t=await this.http.get("/customer/courses");return t.data.data||t.data},getCustomerCourse:async t=>{let e=await this.http.get(`/customer/courses/${t}`);return e.data.data||e.data},getCustomerCourseModule:async(t,e)=>{let s=await this.http.get(`/customer/courses/${t}/modules/${e}`);return s.data.data||s.data}}}get management(){return{getAnalytics:async t=>{let e=await this.http.get("/management/analytics",t);return e.data.data||e.data},updateInventory:async t=>{let e=await this.http.post("/management/inventory/update",t);return e.data.data||e.data},getOrders:async t=>{let e=await this.http.get("/management/orders",t);return{data:e.data.data,pagination:e.data.pagination}},exportCustomers:async t=>{let e=await this.http.get("/management/export/customers",t);return e.data.data||e.data},getWebhookData:async t=>{let e=await this.http.get("/management/webhooks/data",t);return e.data.data||e.data}}}get customTokens(){return{generateToken:async t=>{let e=await this.http.post("/custom/tokens",t);return e.data.data||e.data},listTokens:async()=>{let t=await this.http.get("/custom/tokens");return t.data.data||t.data},revokeToken:async t=>{let e=await this.http.delete(`/custom/tokens/${t}`);return e.data.data||e.data},getTokenStats:async t=>{let e=await this.http.get(`/custom/tokens/${t}/stats`);return e.data.data||e.data},validateToken:async t=>{let e=await this.http.post("/custom/tokens/validate",{token:t});return e.data.data||e.data},getTokenPermissions:async()=>{let t=await this.http.get("/custom/tokens/permissions");return t.data.data||t.data}}}buildProductParams(t,e,s,r){let n={};return t&&(t.field==="featured"&&t.operator==="="&&t.value&&(n.featured=!0),t.field==="category"&&t.operator==="="&&(n.category=t.value),t.field==="price"&&t.operator===">="&&(n.price_min=t.value),t.field==="price"&&t.operator==="<="&&(n.price_max=t.value)),e&&s&&(n.sort=`${e}_${s}`),r&&(n.per_page=r),n}log(t,e){this.config.enableLogging&&console.log(`[StorefrontSDK] ${t}`,e||"")}getInfo(){return{version:this.config.version,environment:o.info,config:{apiUrl:this.config.apiUrl,publicKey:this.config.publicKey,environment:this.config.environment,timeout:this.config.timeout,maxRetries:this.config.maxRetries,enableLogging:this.config.enableLogging}}}async healthCheck(){try{return await this.http.get("/health"),{status:"ok"}}catch(t){return{status:"error",message:t instanceof Error?t.message:"Unknown error"}}}};f.instances=new Map;var g=f;function m(c){return g.createInstance(c)}function R(c){return typeof globalThis<"u"&&globalThis.window&&globalThis.window.React?globalThis.window.React.useMemo(()=>m(c),[c.apiUrl,c.publicKey,c.environment]):m(c)}function P(c){return typeof globalThis<"u"&&globalThis.window&&globalThis.window.Vue?globalThis.window.Vue.computed(()=>m(c)):m(c)}0&&(module.exports={Environment,SecureStorefrontSDK,SecurityManager,UniversalHttpClient,createStorefrontSDK,useStorefront,useStorefrontSDK});
//# sourceMappingURL=index.js.map