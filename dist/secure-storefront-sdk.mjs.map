{"version":3,"sources":["../src/core/environment.ts","../src/core/security.ts","../src/core/http-client.ts","../src/secure-storefront-sdk.ts"],"sourcesContent":["/**\n * Environment Detection and Configuration\n * Secure environment handling for client/server-side compatibility\n */\n\nexport interface EnvironmentInfo {\n  isServer: boolean;\n  isBrowser: boolean;\n  isWebWorker: boolean;\n  isNode: boolean;\n  platform: 'browser' | 'node' | 'webworker' | 'unknown';\n}\n\nexport class Environment {\n  private static _info: EnvironmentInfo | null = null;\n\n  static get info(): EnvironmentInfo {\n    if (!this._info) {\n      this._info = this.detect();\n    }\n    return this._info;\n  }\n\n  private static detect(): EnvironmentInfo {\n    // Browser detection (most specific first)\n    const isBrowser = typeof window !== 'undefined' && \n                      typeof window.document !== 'undefined' && \n                      typeof window.navigator !== 'undefined';\n\n    // Web Worker detection\n    const isWebWorker = typeof (globalThis as any).importScripts === 'function' && \n                        typeof (globalThis as any).navigator !== 'undefined' && \n                        !isBrowser;\n\n    // Server-side detection (Node.js) - only if not browser\n    const isNode = !isBrowser && \n                   typeof process !== 'undefined' && \n                   process.versions && \n                   !!process.versions.node;\n\n    // Server-side is Node.js environment\n    const isServer = isNode;\n\n    let platform: 'browser' | 'node' | 'webworker' | 'unknown' = 'unknown';\n    if (isNode) platform = 'node';\n    else if (isBrowser) platform = 'browser';\n    else if (isWebWorker) platform = 'webworker';\n\n    return {\n      isServer,\n      isBrowser,\n      isWebWorker,\n      isNode,\n      platform\n    };\n  }\n\n  /**\n   * Get environment variables securely\n   * Only works server-side for security\n   */\n  static getEnvVar(key: string): string | undefined {\n    if (!this.info.isServer) {\n      console.warn(`Environment variable access attempted in ${this.info.platform} environment. Use configuration object instead.`);\n      return undefined;\n    }\n\n    // Node.js environment\n    if (typeof process !== 'undefined' && process.env) {\n      return process.env[key];\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Check if we can use secure features\n   */\n  static canUseSecureFeatures(): boolean {\n    return this.info.isServer || (this.info.isBrowser && \n      typeof (globalThis as any).window !== 'undefined' && \n      (globalThis as any).window.isSecureContext);\n  }\n\n  /**\n   * Get secure crypto implementation\n   */\n  static getCrypto(): any {\n    if (this.info.isServer && typeof require !== 'undefined') {\n      try {\n        return require('crypto');\n      } catch {\n        return null;\n      }\n    }\n\n    if (this.info.isBrowser && \n        typeof (globalThis as any).window !== 'undefined' && \n        (globalThis as any).window.crypto && \n        (globalThis as any).window.crypto.subtle) {\n      return (globalThis as any).window.crypto;\n    }\n\n    return null;\n  }\n\n  /**\n   * Check if fetch is available\n   */\n  static hasFetch(): boolean {\n    return typeof fetch !== 'undefined';\n  }\n\n  /**\n   * Get appropriate HTTP client\n   */\n  static getHttpClient(): any {\n    // In Next.js environment, fetch should always be available\n    // Next.js polyfills fetch for both client and server\n    if (this.hasFetch()) {\n      return fetch;\n    }\n\n    // If fetch is not available, something is wrong with the environment\n    throw new Error('Fetch is not available. This should not happen in a Next.js environment.');\n  }\n}","/**\n * Security Module - HMAC Authentication & Data Protection\n * Framework-agnostic security implementation\n */\n\nimport { Environment } from './environment';\n\nexport interface SecurityConfig {\n  publicKey: string;\n  secretKey?: string; // Only for server-side\n  signatureVersion: string;\n  timestampTolerance: number;\n  authToken?: string; // Bearer token for authenticated requests\n  cartToken?: string; // Cart token for session management\n}\n\nexport class SecurityManager {\n  private config: SecurityConfig;\n\n  constructor(config: SecurityConfig) {\n    this.config = {\n      ...config,\n      signatureVersion: config.signatureVersion || 'v1',\n      timestampTolerance: config.timestampTolerance || 300 // 5 minutes\n    };\n\n    // Validate security requirements\n    this.validateConfig();\n  }\n\n  /**\n   * Set authentication token for authenticated requests\n   */\n  setAuthToken(token: string | null): void {\n    this.config.authToken = token || undefined;\n  }\n\n  /**\n   * Get current authentication token\n   */\n  getAuthToken(): string | undefined {\n    return this.config.authToken;\n  }\n\n  /**\n   * Set cart token for session management\n   */\n  setCartToken(token: string | null): void {\n    this.config.cartToken = token || undefined;\n  }\n\n  /**\n   * Get current cart token\n   */\n  getCartToken(): string | undefined {\n    return this.config.cartToken;\n  }\n\n  private validateConfig(): void {\n    if (!this.config.publicKey) {\n      throw new Error('Public key is required');\n    }\n\n    // Server-side requires secret key for HMAC\n    if (Environment.info.isServer && !this.config.secretKey) {\n      throw new Error('Secret key is required for server-side operations');\n    }\n\n    // Client-side should not have secret key\n    if (Environment.info.isBrowser && this.config.secretKey) {\n      console.warn('Secret key detected in browser environment. This is a security risk!');\n    }\n  }\n\n  /**\n   * Generate HMAC signature (server-side only)\n   */\n  async generateSignature(\n    timestamp: string,\n    method: string,\n    path: string,\n    body: string = ''\n  ): Promise<string> {\n    if (!Environment.info.isServer) {\n      throw new Error('Signature generation is only available server-side');\n    }\n\n    if (!this.config.secretKey) {\n      throw new Error('Secret key required for signature generation');\n    }\n\n    const crypto = Environment.getCrypto();\n    if (!crypto) {\n      throw new Error('Crypto module not available');\n    }\n\n    // Create payload for signing\n    const payload = [\n      this.config.signatureVersion,\n      timestamp,\n      method.toUpperCase(),\n      path,\n      this.hashString(body, crypto)\n    ].join('\\n');\n\n    // Generate HMAC signature\n    const hmac = crypto.createHmac('sha256', this.config.secretKey);\n    hmac.update(payload);\n    return hmac.digest('hex');\n  }\n\n  /**\n   * Verify HMAC signature (server-side only)\n   */\n  async verifySignature(\n    signature: string,\n    timestamp: string,\n    method: string,\n    path: string,\n    body: string = ''\n  ): Promise<boolean> {\n    if (!Environment.info.isServer) {\n      throw new Error('Signature verification is only available server-side');\n    }\n\n    // Check timestamp validity\n    const now = Math.floor(Date.now() / 1000);\n    const requestTime = parseInt(timestamp);\n    \n    if (Math.abs(now - requestTime) > this.config.timestampTolerance) {\n      return false;\n    }\n\n    try {\n      const expectedSignature = await this.generateSignature(timestamp, method, path, body);\n      return this.constantTimeCompare(signature, expectedSignature);\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get authentication headers for requests\n   */\n  getAuthHeaders(method: string, path: string, body: string = ''): Record<string, string> {\n    const timestamp = Math.floor(Date.now() / 1000).toString();\n    \n    const headers: Record<string, string> = {\n      'X-Public-Key': this.config.publicKey,\n      'X-Timestamp': timestamp,\n      'X-Signature-Version': this.config.signatureVersion\n    };\n\n    // Add Bearer token for authenticated requests\n    if (this.config.authToken) {\n      headers['Authorization'] = `Bearer ${this.config.authToken}`;\n      // console.log('DEBUG: Adding Authorization header:', `Bearer ${this.config.authToken.substring(0, 20)}...`);\n    } else {\n      // console.log('DEBUG: No auth token available, skipping Authorization header');\n    }\n\n    // Add cart token for session management\n    if (this.config.cartToken) {\n      headers['X-Cart-Token'] = this.config.cartToken;\n      // console.log('DEBUG: Adding cart token header:', this.config.cartToken.substring(0, 10) + '...');\n    }\n\n    // Add signature for both server-side and client-side requests if secret key is available\n    if (this.config.secretKey) {\n      try {\n        if (Environment.info.isServer) {\n          // For server-side, use synchronous generation\n          const signature = this.generateSignatureSync(timestamp, method, path, body);\n          headers['X-Signature'] = signature;\n        } else if (Environment.info.isBrowser) {\n          // For browser, use async Web Crypto API\n          // We'll generate this synchronously using a crypto library for browser\n          const signature = this.generateBrowserSignature(timestamp, method, path, body);\n          headers['X-Signature'] = signature;\n        }\n      } catch (error) {\n        console.warn('Failed to generate signature:', error);\n        headers['X-Client-Auth'] = 'true';\n      }\n    } else {\n      // No secret key available, use client auth header\n      headers['X-Client-Auth'] = 'true';\n    }\n\n    return headers;\n  }\n\n  /**\n   * Synchronous signature generation for Node.js\n   */\n  private generateSignatureSync(\n    timestamp: string,\n    method: string,\n    path: string,\n    body: string = ''\n  ): string {\n    if (!Environment.info.isServer || !this.config.secretKey) {\n      throw new Error('Synchronous signature generation requires server environment and secret key');\n    }\n\n    const crypto = Environment.getCrypto();\n    if (!crypto) {\n      throw new Error('Crypto module not available');\n    }\n\n    const payload = [\n      this.config.signatureVersion,\n      timestamp,\n      method.toUpperCase(),\n      path,\n      crypto.createHash('sha256').update(body).digest('hex')\n    ].join('\\n');\n\n    return crypto.createHmac('sha256', this.config.secretKey).update(payload).digest('hex');\n  }\n\n  /**\n   * Hash string with SHA-256\n   */\n  private hashString(input: string, crypto: any): string {\n    if (Environment.info.isServer) {\n      return crypto.createHash('sha256').update(input).digest('hex');\n    } else {\n      // For browser environment, we need to use Web Crypto API\n      // This is a simplified implementation\n      return input; // In real implementation, use Web Crypto API\n    }\n  }\n\n  /**\n   * Generate HMAC signature for browser environments\n   * Uses a synchronous approach that mimics the server implementation\n   */\n  private generateBrowserSignature(\n    timestamp: string,\n    method: string,\n    path: string,\n    body: string = ''\n  ): string {\n    if (!this.config.secretKey) {\n      throw new Error('Secret key required for signature generation');\n    }\n\n    // Use the same logic as server-side\n    const bodyHash = this.sha256(body);\n    const payload = [\n      this.config.signatureVersion,\n      timestamp,\n      method.toUpperCase(),\n      path,\n      bodyHash\n    ].join('\\n');\n\n    // Generate HMAC using the same method as server\n    return this.hmacSha256(payload, this.config.secretKey);\n  }\n\n  /**\n   * SHA-256 hash implementation compatible with server\n   */\n  private sha256(data: string): string {\n    // For empty string, return the standard SHA-256 hash\n    if (!data) {\n      return 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855';\n    }\n\n    // Use crypto-js library approach\n    return require('crypto-js/sha256')(data).toString();\n  }\n\n  /**\n   * HMAC-SHA256 implementation compatible with server\n   */\n  private hmacSha256(data: string, key: string): string {\n    const CryptoJS = require('crypto-js');\n    return CryptoJS.HmacSHA256(data, key).toString();\n  }\n\n  /**\n   * Constant-time string comparison to prevent timing attacks\n   */\n  private constantTimeCompare(a: string, b: string): boolean {\n    if (a.length !== b.length) {\n      return false;\n    }\n\n    let result = 0;\n    for (let i = 0; i < a.length; i++) {\n      result |= a.charCodeAt(i) ^ b.charCodeAt(i);\n    }\n\n    return result === 0;\n  }\n\n  /**\n   * Sanitize data for client-side exposure\n   */\n  sanitizeClientData(data: any): any {\n    if (Array.isArray(data)) {\n      return data.map(item => this.sanitizeClientData(item));\n    }\n\n    if (data && typeof data === 'object') {\n      const sanitized: any = {};\n      const sensitiveFields = [\n        'password', 'secret', 'key', 'token', 'api_key', \n        'private_key', 'secret_key', 'webhook_secret',\n        'email_verified_at', 'remember_token', 'deleted_at',\n        'created_by', 'updated_by', 'deleted_by'\n      ];\n\n      // Allow specific legitimate tokens that are needed by the client\n      const allowedTokens = [\n        'session_token', 'csrf_token', 'access_token', 'refresh_token', 'token'\n      ];\n\n      for (const [key, value] of Object.entries(data)) {\n        const keyLower = key.toLowerCase();\n        \n        // Check if this is an allowed token\n        const isAllowedToken = allowedTokens.some(allowedToken => \n          keyLower === allowedToken\n        );\n        \n        const isSensitive = !isAllowedToken && sensitiveFields.some(field => \n          keyLower.includes(field) || keyLower.endsWith('_secret') || keyLower.endsWith('_token')\n        );\n\n        if (!isSensitive) {\n          sanitized[key] = this.sanitizeClientData(value);\n        } else {\n          // Debug: Log what's being filtered out\n          console.log(`üö´ SecurityManager: Filtering out sensitive field: ${key} (isAllowedToken: ${isAllowedToken})`);\n        }\n      }\n\n      return sanitized;\n    }\n\n    return data;\n  }\n\n  /**\n   * Generate secure random string\n   */\n  generateSecureRandom(length: number = 32): string {\n    const crypto = Environment.getCrypto();\n    \n    if (Environment.info.isServer && crypto) {\n      return crypto.randomBytes(length).toString('hex');\n    } else if (Environment.info.isBrowser && crypto && crypto.getRandomValues) {\n      const array = new Uint8Array(length);\n      crypto.getRandomValues(array);\n      return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\n    }\n\n    // Fallback (less secure)\n    console.warn('Using fallback random generation - not cryptographically secure');\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n  }\n\n  /**\n   * Validate API response integrity\n   */\n  validateResponse(response: any): boolean {\n    // Basic validation - ensure response has expected structure\n    if (!response || typeof response !== 'object') {\n      return false;\n    }\n\n    // Check for success indicator\n    if (response.success !== undefined && typeof response.success !== 'boolean') {\n      return false;\n    }\n\n    // Validate data structure if present\n    if (response.data !== undefined && response.data !== null) {\n      // Sanitize data for client-side\n      response.data = this.sanitizeClientData(response.data);\n    }\n\n    return true;\n  }\n}","/**\n * Universal HTTP Client - Framework Agnostic\n * Works in Browser, Node.js, Web Workers, and any JavaScript environment\n */\n\nimport { Environment } from './environment';\nimport { SecurityManager } from './security';\n\nexport interface HttpConfig {\n  baseUrl: string;\n  timeout: number;\n  maxRetries: number;\n  retryDelay: number;\n  headers: Record<string, string>;\n}\n\nexport interface HttpRequest {\n  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE' | 'OPTIONS';\n  url: string;\n  data?: any;\n  headers?: Record<string, string>;\n  timeout?: number;\n}\n\nexport interface HttpResponse<T = any> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: Record<string, string>;\n}\n\nexport class UniversalHttpClient {\n  private config: HttpConfig;\n  private security: SecurityManager;\n\n  constructor(config: Partial<HttpConfig>, security: SecurityManager) {\n    this.config = {\n      timeout: 30000,\n      maxRetries: 2, // Reduced from 3 to 2\n      retryDelay: 500, // Reduced from 1000ms to 500ms\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      ...config,\n      baseUrl: config.baseUrl || ''\n    };\n    this.security = security;\n  }\n\n  /**\n   * Make HTTP request with automatic retry and security headers\n   */\n  async request<T = any>(request: HttpRequest): Promise<HttpResponse<T>> {\n    const url = this.buildUrl(request.url);\n    const body = request.data ? JSON.stringify(request.data) : '';\n    \n    // Get security headers\n    const authHeaders = this.security.getAuthHeaders(\n      request.method,\n      new URL(url).pathname,\n      body\n    );\n\n    // Merge headers\n    const headers = {\n      ...this.config.headers,\n      ...authHeaders,\n      ...request.headers\n    };\n\n    // Add User-Agent for Node.js\n    if (Environment.info.isNode) {\n      headers['User-Agent'] = `StorefrontSDK/1.0 (${Environment.info.platform})`;\n    }\n\n    let lastError: Error;\n\n    // Retry logic\n    for (let attempt = 0; attempt <= this.config.maxRetries; attempt++) {\n      try {\n        const response = await this.makeRequest({\n          ...request,\n          url,\n          headers\n        }, body);\n\n        // Validate response security\n        if (!this.security.validateResponse(response.data)) {\n          throw new Error('Invalid response format');\n        }\n\n        return response as HttpResponse<T>;\n      } catch (error) {\n        lastError = error as Error;\n        \n        // Don't retry on certain errors\n        if (this.shouldNotRetry(error as Error) || attempt === this.config.maxRetries) {\n          break;\n        }\n\n        // Calculate retry delay with exponential backoff\n        let retryDelay = this.config.retryDelay * Math.pow(2, attempt);\n        \n        // Handle rate limiting with Retry-After header\n        const status = (error as any).status || (error as any).response?.status;\n        if (status === 429) {\n          const retryAfter = (error as any).response?.headers?.['retry-after'];\n          if (retryAfter) {\n            // Retry-After can be in seconds or HTTP date\n            const retryAfterMs = isNaN(retryAfter) \n              ? new Date(retryAfter).getTime() - Date.now()\n              : parseInt(retryAfter) * 1000;\n            \n            if (retryAfterMs > 0 && retryAfterMs < 60000) { // Max 60 seconds\n              retryDelay = retryAfterMs;\n            }\n          }\n        }\n\n        // Wait before retry\n        await this.delay(retryDelay);\n      }\n    }\n\n    throw lastError!;\n  }\n\n  /**\n   * Make the actual HTTP request based on environment\n   */\n  private async makeRequest<T>(request: HttpRequest & { url: string }, body: string): Promise<HttpResponse<T>> {\n    const timeout = request.timeout || this.config.timeout;\n\n    if (Environment.info.isBrowser || Environment.hasFetch()) {\n      return this.fetchRequest(request, body, timeout);\n    } else if (Environment.info.isNode) {\n      return this.nodeRequest(request, body, timeout);\n    } else {\n      throw new Error('No HTTP client available for this environment');\n    }\n  }\n\n  /**\n   * Fetch-based request (Browser/Node.js with fetch)\n   */\n  private async fetchRequest<T>(request: HttpRequest & { url: string }, body: string, timeout: number): Promise<HttpResponse<T>> {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    try {\n      const fetchOptions: RequestInit = {\n        method: request.method,\n        headers: request.headers,\n        signal: controller.signal\n      };\n\n      if (request.method !== 'GET') {\n        fetchOptions.body = body;\n      }\n\n      const response = await fetch(request.url, fetchOptions);\n      clearTimeout(timeoutId);\n\n      const responseData = await this.parseResponse(response);\n\n      // Check for HTTP error status codes\n      if (!response.ok) {\n        // Create a plain object error instead of Error instance to avoid stack traces\n        const error = {\n          message: responseData.message || `HTTP ${response.status}: ${response.statusText}`,\n          response: {\n            data: responseData,\n            status: response.status,\n            statusText: response.statusText,\n            headers: this.extractHeaders(response.headers)\n          },\n          status: response.status,\n          name: 'HttpError'\n        };\n        throw error;\n      }\n\n      return {\n        data: responseData,\n        status: response.status,\n        statusText: response.statusText,\n        headers: this.extractHeaders(response.headers)\n      };\n    } catch (error) {\n      clearTimeout(timeoutId);\n      throw this.normalizeError(error);\n    }\n  }\n\n  /**\n   * Node.js request (fallback for environments without fetch)\n   */\n  private async nodeRequest<T>(request: HttpRequest & { url: string }, body: string, timeout: number): Promise<HttpResponse<T>> {\n    // Try to use available Node.js HTTP client\n    const httpClient = Environment.getHttpClient();\n    \n    if (httpClient.default) {\n      // Using axios\n      const axios = httpClient.default;\n      try {\n        const response = await axios({\n          method: request.method,\n          url: request.url,\n          data: request.method !== 'GET' ? JSON.parse(body || '{}') : undefined,\n          headers: request.headers,\n          timeout\n        });\n\n        return {\n          data: response.data,\n          status: response.status,\n          statusText: response.statusText,\n          headers: response.headers\n        };\n      } catch (error: any) {\n        throw this.normalizeError(error);\n      }\n    } else {\n      // Using node-fetch or similar\n      return this.fetchRequest(request, body, timeout);\n    }\n  }\n\n  /**\n   * Parse response based on content type\n   */\n  private async parseResponse(response: Response): Promise<any> {\n    const contentType = response.headers.get('content-type') || '';\n\n    if (contentType.includes('application/json')) {\n      return response.json();\n    } else if (contentType.includes('text/')) {\n      return response.text();\n    } else {\n      return response.blob();\n    }\n  }\n\n  /**\n   * Extract headers from response\n   */\n  private extractHeaders(headers: Headers | Record<string, string>): Record<string, string> {\n    const result: Record<string, string> = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach((value, key) => {\n        result[key] = value;\n      });\n    } else {\n      Object.assign(result, headers);\n    }\n\n    return result;\n  }\n\n  /**\n   * Build full URL\n   */\n  private buildUrl(path: string): string {\n    if (path.startsWith('http://') || path.startsWith('https://')) {\n      return path;\n    }\n\n    const baseUrl = this.config.baseUrl.replace(/\\/$/, '');\n    const cleanPath = path.startsWith('/') ? path : `/${path}`;\n    \n    return `${baseUrl}${cleanPath}`;\n  }\n\n  /**\n   * Check if error should not be retried\n   */\n  private shouldNotRetry(error: any): boolean {\n    // Get the HTTP status code from the error\n    const status = error.status || error.response?.status;\n    \n    if (status) {\n      // Don't retry on client errors (4xx) - these are permanent errors\n      if (status >= 400 && status < 500) {\n        // Exception: 408 (Request Timeout) and 429 (Too Many Requests) can be retried\n        return !(status === 408 || status === 429);\n      }\n      \n      // Don't retry on certain server errors that are permanent\n      if (status === 501 || status === 505) { // Not Implemented, HTTP Version Not Supported\n        return true;\n      }\n    }\n\n    // Don't retry on certain network errors\n    const nonRetryableErrors = ['ENOTFOUND', 'ECONNREFUSED', 'CERT_', 'ABORT_ERR'];\n    return nonRetryableErrors.some(err => error.message?.includes(err));\n  }\n\n  /**\n   * Normalize errors across different HTTP clients\n   */\n  private normalizeError(error: any): any {\n    // If the error already has the proper structure (from our error handling), return it as-is\n    if (error.response && error.response.data) {\n      return error;\n    }\n    \n    if (error.response) {\n      // Axios-style error - return as plain object\n      return {\n        message: `HTTP ${error.response.status}: ${error.response.statusText}`,\n        response: error.response,\n        status: error.response.status,\n        name: 'HttpError'\n      };\n    } else if (error.status) {\n      // Fetch-style error - return as plain object\n      return {\n        message: `HTTP ${error.status}: ${error.statusText}`,\n        status: error.status,\n        name: 'HttpError'\n      };\n    } else {\n      // Network or other error - only create Error object for genuine network errors\n      if (error instanceof Error && (error.name === 'TypeError' || error.name === 'NetworkError')) {\n        return error; // Keep genuine network errors as Error objects\n      }\n      // For other errors, return as plain object\n      return {\n        message: String(error),\n        name: 'UnknownError'\n      };\n    }\n  }\n\n  /**\n   * Delay utility for retries\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  // Convenience methods\n  async get<T = any>(url: string, params?: Record<string, any>, headers?: Record<string, string>): Promise<HttpResponse<T>> {\n    let requestUrl = url;\n    \n    if (params && Object.keys(params).length > 0) {\n      const searchParams = new URLSearchParams();\n      \n      for (const [key, value] of Object.entries(params)) {\n        if (value !== undefined && value !== null && value !== '') {\n          searchParams.append(key, String(value));\n        }\n      }\n      \n      const queryString = searchParams.toString();\n      if (queryString) {\n        requestUrl += (url.includes('?') ? '&' : '?') + queryString;\n      }\n    }\n    \n    return this.request<T>({ method: 'GET', url: requestUrl, headers });\n  }\n\n  async post<T = any>(url: string, data?: any, headers?: Record<string, string>): Promise<HttpResponse<T>> {\n    return this.request<T>({ method: 'POST', url, data, headers });\n  }\n\n  async put<T = any>(url: string, data?: any, headers?: Record<string, string>): Promise<HttpResponse<T>> {\n    return this.request<T>({ method: 'PUT', url, data, headers });\n  }\n\n  async patch<T = any>(url: string, data?: any, headers?: Record<string, string>): Promise<HttpResponse<T>> {\n    return this.request<T>({ method: 'PATCH', url, data, headers });\n  }\n\n  async delete<T = any>(url: string, headers?: Record<string, string>): Promise<HttpResponse<T>> {\n    return this.request<T>({ method: 'DELETE', url, headers });\n  }\n}","/**\n * Secure Storefront SDK - Framework Agnostic\n * Works with any JavaScript framework: React, Vue, Angular, Svelte, Vanilla JS\n * Supports both client-side and server-side environments\n */\n\nimport { Environment } from './core/environment';\nimport { SecurityManager } from './core/security';\nimport { UniversalHttpClient } from './core/http-client';\n\nexport interface StorefrontConfig {\n  apiUrl: string;\n  publicKey: string;\n  secretKey?: string; // Only for server-side\n  environment?: 'production' | 'development';\n  version?: string;\n  timeout?: number;\n  maxRetries?: number;\n  retryDelay?: number;\n  enableLogging?: boolean;\n}\n\nexport interface ApiResponse<T = any> {\n  success: boolean;\n  data: T;\n  message?: string;\n  pagination?: {\n    current_page: number;\n    last_page: number;\n    per_page: number;\n    total: number;\n    has_more_pages: boolean;\n  };\n}\n\nexport interface Product {\n  id: number;\n  name: string;\n  slug: string;\n  description?: string;\n  price: number;\n  image?: {\n    url: string;\n    alt?: string;\n  };\n  category?: Category;\n  is_featured?: boolean;\n  stock?: number;\n}\n\nexport interface Category {\n  id: number;\n  name: string;\n  slug: string;\n  description?: string;\n  image?: string;\n}\n\nexport interface Cart {\n  items: CartItem[];\n  count: number;\n  subtotal: number;\n  total: number;\n  currency: string;\n}\n\nexport interface CartItem {\n  id: number;\n  product_id: number;\n  product: Product;\n  quantity: number;\n  price: number;\n  total: number;\n}\n\nexport interface Store {\n  id: number;\n  name: string;\n  description?: string;\n  logo?: string;\n  currency: string;\n  settings?: Record<string, any>;\n}\n\nexport interface Customer {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone?: string;\n}\n\nexport interface Order {\n  id: number;\n  status: string;\n  items: OrderItem[];\n  total: number;\n  created_at: string;\n}\n\nexport interface OrderItem {\n  id: number;\n  product: Product;\n  quantity: number;\n  price: number;\n}\n\nexport interface Review {\n  id: number;\n  rating: number;\n  comment: string;\n  reviewer: {\n    id: number;\n    name: string;\n    email?: string;\n  } | null;\n  product?: {\n    id: number;\n    name: string;\n    slug: string;\n  } | null;\n  created_at: string;\n}\n\nexport interface Page {\n  id: number;\n  title: string;\n  url: string;\n  content: string;\n  meta_title?: string;\n  meta_description?: string;\n  is_active: boolean;\n}\n\nexport interface Course {\n  id: number;\n  title: string;\n  description: string;\n  modules: CourseModule[];\n  progress?: CourseProgress;\n}\n\nexport interface CourseModule {\n  id: number;\n  title: string;\n  content: string;\n  order: number;\n  is_completed?: boolean;\n}\n\nexport interface CourseProgress {\n  course_id: number;\n  completed_modules: number;\n  total_modules: number;\n  progress_percentage: number;\n}\n\n/**\n * Main Storefront SDK Class\n * Framework-agnostic with client/server-side support\n */\nexport class SecureStorefrontSDK {\n  private config: StorefrontConfig & {\n    environment: 'production' | 'development';\n    version: string;\n    timeout: number;\n    maxRetries: number;\n    retryDelay: number;\n    enableLogging: boolean;\n  };\n  private security: SecurityManager;\n  private http: UniversalHttpClient;\n  private static instances: Map<string, SecureStorefrontSDK> = new Map();\n\n  constructor(config: StorefrontConfig) {\n    this.config = {\n      environment: 'production',\n      version: '1.0.0',\n      timeout: 30000,\n      maxRetries: 3,\n      retryDelay: 1000,\n      enableLogging: false,\n      ...config\n    };\n\n    // Initialize security manager\n    this.security = new SecurityManager({\n      publicKey: this.config.publicKey,\n      secretKey: this.config.secretKey,\n      signatureVersion: 'v1',\n      timestampTolerance: 300\n    });\n\n    // Initialize HTTP client\n    this.http = new UniversalHttpClient(\n      {\n        baseUrl: this.config.apiUrl,\n        timeout: this.config.timeout,\n        maxRetries: this.config.maxRetries,\n        retryDelay: this.config.retryDelay\n      },\n      this.security\n    );\n\n    this.log('SDK initialized', { environment: Environment.info.platform });\n  }\n\n  /**\n   * Set authentication token for authenticated requests\n   */\n  setAuthToken(token: string | null): void {\n    this.security.setAuthToken(token);\n    this.log('Auth token updated', { hasToken: !!token });\n  }\n\n  /**\n   * Get current authentication token\n   */\n  getAuthToken(): string | undefined {\n    return this.security.getAuthToken();\n  }\n\n  /**\n   * Set cart token for session management\n   */\n  setCartToken(token: string | null): void {\n    this.security.setCartToken(token);\n    this.log('Cart token updated', { hasToken: !!token });\n  }\n\n  /**\n   * Get current cart token\n   */\n  getCartToken(): string | undefined {\n    return this.security.getCartToken();\n  }\n\n  /**\n   * Create singleton instance (recommended for most use cases)\n   */\n  static createInstance(config: StorefrontConfig): SecureStorefrontSDK {\n    const key = `${config.apiUrl}_${config.publicKey}`;\n\n    if (!this.instances.has(key)) {\n      this.instances.set(key, new SecureStorefrontSDK(config));\n    }\n\n    return this.instances.get(key)!;\n  }\n\n  /**\n   * Store API\n   */\n  get store() {\n    return {\n      get: async (params?: { include?: string[] }): Promise<Store> => {\n        const response = await this.http.get<ApiResponse<Store>>('/store', {\n          'X-Include': params?.include?.join(',') || ''\n        });\n        return (response.data as any).data || response.data;\n      },\n\n      getCurrencies: async (): Promise<Array<{ code: string; symbol: string; name: string }>> => {\n        const response = await this.http.get<ApiResponse<any>>('/store/currencies');\n        return (response.data as any).data || response.data;\n      },\n\n      changeCurrency: async (currency: string): Promise<void> => {\n        await this.http.post('/store/currency', { symbol: currency });\n      },\n\n      getSettings: async (): Promise<Record<string, any>> => {\n        const response = await this.http.get<ApiResponse<any>>('/store/settings');\n        return (response.data as any).data || response.data;\n      },\n\n      getFeatures: async (): Promise<Array<{\n        id: number;\n        title: string;\n        description: string;\n        icon: string;\n        sort_order: number;\n      }>> => {\n        const response = await this.http.get<ApiResponse<any>>('/store/features');\n        return (response.data as any).data || response.data;\n      },\n\n      getBanners: async (): Promise<Array<{\n        id: number;\n        title: string;\n        description: string;\n        image_url: string;\n        link_url: string;\n        sort_order: number;\n      }>> => {\n        const response = await this.http.get<ApiResponse<any>>('/store/banners');\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Products API with Firebase/Supabase-style query builder\n   */\n  get products() {\n    return {\n      // Firebase/Supabase-style method chaining\n      where: (field: string, operator: '=' | '!=' | '>' | '<' | '>=' | '<=' | 'like', value: any) => ({\n        orderBy: (orderField: string, direction: 'asc' | 'desc' = 'asc') => ({\n          limit: (count: number) => ({\n            get: async (): Promise<Product[]> => {\n              const params = this.buildProductParams({ field, operator, value }, orderField, direction, count);\n              const response = await this.http.get<ApiResponse<Product[]>>('/products', params);\n              return (response.data as any).data || response.data;\n            }\n          }),\n          get: async (): Promise<Product[]> => {\n            const params = this.buildProductParams({ field, operator, value }, orderField, direction);\n            const response = await this.http.get<ApiResponse<Product[]>>('/products', params);\n            return (response.data as any).data || response.data;\n          }\n        }),\n        get: async (): Promise<Product[]> => {\n          const params = this.buildProductParams({ field, operator, value });\n          const response = await this.http.get<ApiResponse<Product[]>>('/products', params);\n          return (response.data as any).data || response.data;\n        }\n      }),\n\n      // Direct methods\n      getAll: async (params?: {\n        page?: number;\n        per_page?: number;\n        search?: string;\n        category?: string;\n        sort?: string;\n      }): Promise<{ data: Product[]; pagination?: any }> => {\n        const response = await this.http.get<ApiResponse<Product[]>>('/products', params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      },\n\n      getById: async (id: number): Promise<Product> => {\n        const response = await this.http.get<ApiResponse<Product>>(`/products/${id}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getBySlug: async (slug: string): Promise<Product> => {\n        const response = await this.http.get<ApiResponse<Product>>(`/products/${slug}`);\n        return (response.data as any).data || response.data;\n      },\n\n      search: async (query: string, options?: {\n        category?: string;\n        price_min?: number;\n        price_max?: number;\n        per_page?: number;\n      }): Promise<{ data: Product[]; pagination?: any }> => {\n        const response = await this.http.get<ApiResponse<Product[]>>('/products/search', {\n          q: query,\n          ...options\n        });\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      },\n\n      getFeatured: async (limit = 8): Promise<Product[]> => {\n        const response = await this.http.get<ApiResponse<Product[]>>('/featured-products', { limit });\n        return (response.data as any).data || response.data;\n      },\n\n      getRelated: async (productId: number, limit = 4): Promise<Product[]> => {\n        const response = await this.http.get<ApiResponse<Product[]>>(`/products/${productId}/related`, { limit });\n        return (response.data as any).data || response.data;\n      },\n\n      getReviews: async (productId: number, params?: { page?: number; per_page?: number }): Promise<{\n        data: Review[];\n        pagination?: any;\n      }> => {\n        const response = await this.http.get<ApiResponse<Review[]>>(`/products/${productId}/reviews`, params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      }\n    };\n  }\n\n  /**\n   * Categories API\n   */\n  get categories() {\n    return {\n      getAll: async (): Promise<Category[]> => {\n        const response = await this.http.get<ApiResponse<Category[]>>('/categories');\n        return (response.data as any).data || response.data;\n      },\n\n      getById: async (id: number): Promise<Category> => {\n        const response = await this.http.get<ApiResponse<Category>>(`/categories/${id}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getBySlug: async (slug: string): Promise<Category> => {\n        const response = await this.http.get<ApiResponse<Category>>(`/categories/${slug}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getProducts: async (slug: string, params?: {\n        page?: number;\n        per_page?: number;\n        sort?: string;\n      }): Promise<{ data: Product[]; pagination?: any }> => {\n        const response = await this.http.get<ApiResponse<Product[]>>(`/categories/${slug}/products`, params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      }\n    };\n  }\n\n  /**\n   * Helper method to handle cart token from response\n   */\n  private handleCartResponse(responseData: any): any {\n    if (!responseData) {\n      throw new Error('No response data from server.');\n    }\n    // If the response is an error object from the backend, propagate the message\n    if (responseData.success === false && responseData.message) {\n      throw new Error(responseData.message);\n    }\n    // Extract cart_token from response and store it\n    if (responseData.cart_token) {\n      this.setCartToken(responseData.cart_token);\n    }\n    return responseData;\n  }\n\n  /**\n   * Cart API\n   */\n  get cart() {\n    return {\n      get: async (): Promise<Cart> => {\n        const response = await this.http.get<ApiResponse<Cart>>('/cart');\n        return this.handleCartResponse(response.data.data);\n      },\n\n      addItem: async (productId: number, quantity = 1, options?: {\n        fields?: Record<string, any>;\n        notice?: string;\n      }): Promise<Cart> => {\n        const response = await this.http.post<ApiResponse<Cart>>('/cart/add', {\n          product_id: productId,\n          qty: quantity,\n          ...options\n        });\n        return this.handleCartResponse(response.data.data);\n      },\n\n      updateItem: async (itemId: string, quantity: number): Promise<Cart> => {\n        const response = await this.http.patch<ApiResponse<Cart>>(`/cart/items/${itemId}`, {\n          quantity\n        });\n        return this.handleCartResponse(response.data.data);\n      },\n\n      removeItem: async (itemId: string): Promise<Cart> => {\n        const response = await this.http.delete<ApiResponse<Cart>>(`/cart/items/${itemId}`);\n        return this.handleCartResponse(response.data.data);\n      },\n\n      clear: async (): Promise<void> => {\n        await this.http.delete('/cart/clear');\n        // Clear the stored cart token when cart is cleared\n        this.setCartToken(null);\n      },\n\n      getCount: async (): Promise<number> => {\n        const response = await this.http.get<ApiResponse<{ count: number; cart_token?: string }>>('/cart/count');\n        // Handle cart token from count response as well\n        if (response.data.data.cart_token) {\n          this.setCartToken(response.data.data.cart_token);\n        }\n        return response.data.data.count;\n      },\n\n      applyCoupon: async (code: string): Promise<Cart> => {\n        const response = await this.http.post<ApiResponse<Cart>>('/cart/coupon', { coupon: code });\n        return this.handleCartResponse(response.data.data);\n      },\n\n      removeCoupon: async (): Promise<Cart> => {\n        const response = await this.http.delete<ApiResponse<Cart>>('/cart/coupon');\n        return this.handleCartResponse(response.data.data);\n      },\n\n      validate: async (): Promise<{ valid: boolean; errors?: string[] }> => {\n        const response = await this.http.get<ApiResponse<any>>('/cart/validate');\n        return (response.data as any).data || response.data;\n      },\n\n      getSummary: async (): Promise<{\n        subtotal: number;\n        tax: number;\n        shipping: number;\n        discount: number;\n        total: number;\n      }> => {\n        const response = await this.http.get<ApiResponse<any>>('/cart/summary');\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Authentication API (client-side compatible)\n   */\n  get auth() {\n    return {\n      startPhoneAuth: async (phone: string, countryCode: string): Promise<{ session_token: string }> => {\n        const response = await this.http.post<ApiResponse<any>>('/auth/phone/start', {\n          phone,\n          country_code: countryCode\n        });\n        console.log('SecureSDK: startPhoneAuth full response:', response);\n        console.log('SecureSDK: response.data:', response.data);\n        console.log('SecureSDK: response.data.data:', response.data.data);\n\n        // Laravel API returns: { success: true, data: { session_token: \"...\" }, message: \"...\" }\n        // We need to extract the session_token from response.data.data\n        const responseData = response.data as any;\n\n        console.log('SecureSDK: responseData keys:', Object.keys(responseData));\n        console.log('SecureSDK: responseData.data:', responseData.data);\n        console.log('SecureSDK: responseData.data keys:', responseData.data ? Object.keys(responseData.data) : 'undefined');\n\n        // Fix: Return the session_token directly from the Laravel response structure\n        if (responseData.data && responseData.data.session_token) {\n          console.log('SecureSDK: Found session_token:', responseData.data.session_token);\n          return { session_token: responseData.data.session_token };\n        } else {\n          console.error('SecureSDK: Could not find session_token in response');\n          return responseData;\n        }\n      },\n\n      verifyOTP: async (otp: string, sessionToken: string): Promise<{\n        token: string;\n        customer: Customer;\n      }> => {\n        const requestBody = {\n          code: otp,\n          session_token: sessionToken\n        };\n        console.log('SecureSDK: verifyOTP request body:', requestBody);\n        const response = await this.http.post<ApiResponse<any>>('/auth/phone/verify', requestBody);\n        console.log('üîç SecureSDK: Raw API response before sanitization:', JSON.stringify(response.data, null, 2));\n        console.log('üîç SecureSDK: Extracted data (response.data.data):', JSON.stringify(response.data.data, null, 2));\n        return (response.data as any).data || response.data;\n      },\n\n      resendOTP: async (sessionToken: string): Promise<void> => {\n        const requestBody = {\n          session_token: sessionToken\n        };\n        console.log('SecureSDK: resendOTP request body:', requestBody);\n        await this.http.post<ApiResponse<any>>('/auth/phone/resend', requestBody);\n      },\n\n      completeRegistration: async (data: {\n        firstName: string;\n        lastName: string;\n        email: string;\n        sessionToken: string;\n      }): Promise<{ token: string; customer: Customer }> => {\n        const response = await this.http.post<ApiResponse<any>>('/auth/complete', {\n          firstName: data.firstName,\n          lastName: data.lastName,\n          email: data.email,\n          session_token: data.sessionToken\n        });\n        return (response.data as any).data || response.data;\n      },\n\n      getProfile: async (): Promise<Customer> => {\n        const response = await this.http.get<ApiResponse<Customer>>('/customer/profile');\n        return (response.data as any).data || response.data;\n      },\n\n      updateProfile: async (data: Partial<Customer>): Promise<Customer> => {\n        const response = await this.http.patch<ApiResponse<Customer>>('/customer/profile', data);\n        return (response.data as any).data || response.data;\n      },\n\n      logout: async (): Promise<void> => {\n        await this.http.post('/customer/logout');\n      }\n    };\n  }\n\n  /**\n   * Orders API (requires authentication)\n   */\n  get orders() {\n    return {\n      getAll: async (params?: { page?: number; per_page?: number }): Promise<{\n        data: Order[];\n        pagination?: any;\n      }> => {\n        const response = await this.http.get<ApiResponse<Order[]>>('/customer/orders', params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      },\n\n      getById: async (id: number): Promise<Order> => {\n        const response = await this.http.get<ApiResponse<Order>>(`/customer/orders/${id}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getCourses: async (): Promise<any[]> => {\n        const response = await this.http.get<ApiResponse<any[]>>('/customer/courses');\n        return (response.data as any).data || response.data;\n      },\n\n      getSubscriptions: async (): Promise<any[]> => {\n        const response = await this.http.get<ApiResponse<any[]>>('/customer/subscriptions');\n        return (response.data as any).data || response.data;\n      },\n\n      // Add submitReview for order reviews\n      submitReview: async (orderId: number, reviewData: any): Promise<any> => {\n        const response = await this.http.post<ApiResponse<any>>(`/orders/${orderId}/review`, reviewData);\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Checkout API\n   */\n  get checkout() {\n    return {\n      create: async (): Promise<{\n        type: 'free_order' | 'payment_required';\n        checkout_id?: string;\n        checkout_url?: string;\n        order_id?: number;\n        amount?: number;\n        redirect_url?: string;\n      }> => {\n        const response = await this.http.post<ApiResponse<any>>('/checkout');\n        return (response.data as any).data || response.data;\n      },\n\n      getResult: async (sessionId: string): Promise<{\n        status: string;\n        order?: Order;\n      }> => {\n        const response = await this.http.get<ApiResponse<any>>(`/checkout/${sessionId}/result`);\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Wishlist API (requires authentication)\n   */\n  get wishlist() {\n    return {\n      get: async (): Promise<{ items: Product[]; count: number }> => {\n        const response = await this.http.get<ApiResponse<any>>('/wishlist');\n        return (response.data as any).data || response.data;\n      },\n\n      addItem: async (productId: number): Promise<void> => {\n        await this.http.post('/wishlist', { product_id: productId });\n      },\n\n      removeItem: async (productId: number): Promise<void> => {\n        await this.http.delete(`/wishlist/${productId}`);\n      },\n\n      check: async (productId: number): Promise<{ in_wishlist: boolean }> => {\n        const response = await this.http.get<ApiResponse<any>>(`/wishlist/check/${productId}`);\n        return (response.data as any).data || response.data;\n      },\n\n      clear: async (): Promise<void> => {\n        await this.http.delete('/wishlist/clear');\n      }\n    };\n  }\n\n  /**\n   * Reviews API\n   */\n  get reviews() {\n    return {\n      getAll: async (params?: {\n        page?: number;\n        per_page?: number;\n        rating?: number;\n      }): Promise<{ data: Review[]; pagination?: any }> => {\n        const response = await this.http.get<ApiResponse<Review[]>>('/reviews', params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      },\n\n      getRecent: async (limit = 6): Promise<Review[]> => {\n        const response = await this.http.get<ApiResponse<Review[]>>('/reviews/recent', { limit });\n        return (response.data as any).data || response.data;\n      },\n\n      submit: async (productId: number, data: {\n        rating: number;\n        comment: string;\n      }): Promise<Review> => {\n        const response = await this.http.post<ApiResponse<Review>>(`/products/${productId}/reviews`, data);\n        return (response.data as any).data || response.data;\n      },\n\n      getStats: async (): Promise<any> => {\n        const response = await this.http.get<ApiResponse<any>>('/reviews/stats');\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Components API (for homepage content)\n   */\n  get components() {\n    return {\n      getAll: async (): Promise<any[]> => {\n        const response = await this.http.get<ApiResponse<any[]>>('/components');\n        return (response.data as any).data || response.data;\n      },\n\n      getById: async (id: number): Promise<any> => {\n        const response = await this.http.get<ApiResponse<any>>(`/components/${id}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getProducts: async (id: number, params?: {\n        page?: number;\n        per_page?: number;\n      }): Promise<{ data: Product[]; pagination?: any }> => {\n        const response = await this.http.get<ApiResponse<Product[]>>(`/components/${id}/products`, params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      }\n    };\n  }\n\n  /**\n   * Pages API\n   */\n  get pages() {\n    return {\n      getAll: async (): Promise<Page[]> => {\n        const response = await this.http.get<ApiResponse<Page[]>>('/pages');\n        return (response.data as any).data || response.data;\n      },\n\n      getByUrl: async (url: string): Promise<Page> => {\n        const response = await this.http.get<ApiResponse<Page>>(`/pages/${url}`);\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Courses API (requires authentication)\n   */\n  get courses() {\n    return {\n      getAll: async (params?: { page?: number; per_page?: number }): Promise<{\n        data: Course[];\n        pagination?: any;\n      }> => {\n        const response = await this.http.get<ApiResponse<Course[]>>('/courses', params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      },\n\n      getById: async (id: number): Promise<Course> => {\n        const response = await this.http.get<ApiResponse<Course>>(`/courses/${id}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getProgress: async (courseId: number): Promise<CourseProgress> => {\n        const response = await this.http.get<ApiResponse<CourseProgress>>(`/courses/${courseId}/progress`);\n        return (response.data as any).data || response.data;\n      },\n\n      getModule: async (courseId: number, moduleId: number): Promise<CourseModule> => {\n        const response = await this.http.get<ApiResponse<CourseModule>>(`/courses/${courseId}/modules/${moduleId}`);\n        return (response.data as any).data || response.data;\n      },\n\n      completeModule: async (courseId: number, moduleId: number): Promise<{ success: boolean }> => {\n        const response = await this.http.post<ApiResponse<any>>(`/courses/${courseId}/modules/${moduleId}/complete`);\n        return (response.data as any).data || response.data;\n      },\n\n      // Legacy support for customer/courses endpoints\n      getCustomerCourses: async (): Promise<Course[]> => {\n        const response = await this.http.get<ApiResponse<Course[]>>('/customer/courses');\n        return (response.data as any).data || response.data;\n      },\n\n      getCustomerCourse: async (id: number): Promise<Course> => {\n        const response = await this.http.get<ApiResponse<Course>>(`/customer/courses/${id}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getCustomerCourseModule: async (courseId: number, moduleId: number): Promise<CourseModule> => {\n        const response = await this.http.get<ApiResponse<CourseModule>>(`/customer/courses/${courseId}/modules/${moduleId}`);\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Management API (server-side only, requires secret key)\n   */\n  get management() {\n    return {\n      getAnalytics: async (params?: {\n        start_date?: string;\n        end_date?: string;\n        metrics?: string[];\n      }): Promise<any> => {\n        const response = await this.http.get<ApiResponse<any>>('/management/analytics', params);\n        return (response.data as any).data || response.data;\n      },\n\n      updateInventory: async (data: {\n        product_id: number;\n        quantity: number;\n        operation?: 'set' | 'add' | 'subtract';\n      }): Promise<{ success: boolean }> => {\n        const response = await this.http.post<ApiResponse<any>>('/management/inventory/update', data);\n        return (response.data as any).data || response.data;\n      },\n\n      getOrders: async (params?: {\n        page?: number;\n        per_page?: number;\n        status?: string;\n        date_from?: string;\n        date_to?: string;\n      }): Promise<{ data: Order[]; pagination?: any }> => {\n        const response = await this.http.get<ApiResponse<Order[]>>('/management/orders', params);\n        return {\n          data: response.data.data,\n          pagination: response.data.pagination\n        };\n      },\n\n      exportCustomers: async (params?: {\n        format?: 'csv' | 'json';\n        date_from?: string;\n        date_to?: string;\n      }): Promise<any> => {\n        const response = await this.http.get<ApiResponse<any>>('/management/export/customers', params);\n        return (response.data as any).data || response.data;\n      },\n\n      getWebhookData: async (params?: {\n        type?: string;\n        limit?: number;\n      }): Promise<any[]> => {\n        const response = await this.http.get<ApiResponse<any[]>>('/management/webhooks/data', params);\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Custom Token Management API (requires authentication)\n   */\n  get customTokens() {\n    return {\n      generateToken: async (data: {\n        name: string;\n        permissions: string[];\n        expires_at?: string;\n      }): Promise<{\n        token: string;\n        token_id: string;\n        permissions: string[];\n      }> => {\n        const response = await this.http.post<ApiResponse<any>>('/custom/tokens', data);\n        return (response.data as any).data || response.data;\n      },\n\n      listTokens: async (): Promise<Array<{\n        id: string;\n        name: string;\n        permissions: string[];\n        created_at: string;\n        expires_at?: string;\n        last_used_at?: string;\n      }>> => {\n        const response = await this.http.get<ApiResponse<any[]>>('/custom/tokens');\n        return (response.data as any).data || response.data;\n      },\n\n      revokeToken: async (tokenId: string): Promise<{ success: boolean }> => {\n        const response = await this.http.delete<ApiResponse<any>>(`/custom/tokens/${tokenId}`);\n        return (response.data as any).data || response.data;\n      },\n\n      getTokenStats: async (tokenId: string): Promise<{\n        requests_count: number;\n        last_used_at?: string;\n        endpoints_used: string[];\n      }> => {\n        const response = await this.http.get<ApiResponse<any>>(`/custom/tokens/${tokenId}/stats`);\n        return (response.data as any).data || response.data;\n      },\n\n      validateToken: async (token: string): Promise<{\n        valid: boolean;\n        permissions: string[];\n        expires_at?: string;\n      }> => {\n        const response = await this.http.post<ApiResponse<any>>('/custom/tokens/validate', { token });\n        return (response.data as any).data || response.data;\n      },\n\n      getTokenPermissions: async (): Promise<{\n        available_permissions: string[];\n        permission_descriptions: Record<string, string>;\n      }> => {\n        const response = await this.http.get<ApiResponse<any>>('/custom/tokens/permissions');\n        return (response.data as any).data || response.data;\n      }\n    };\n  }\n\n  /**\n   * Utility Methods\n   */\n\n  // Build query parameters for products\n  private buildProductParams(\n    where?: { field: string; operator: string; value: any },\n    orderField?: string,\n    direction?: string,\n    limit?: number\n  ): Record<string, any> {\n    const params: Record<string, any> = {};\n\n    if (where) {\n      if (where.field === 'featured' && where.operator === '=' && where.value) {\n        params.featured = true;\n      }\n      if (where.field === 'category' && where.operator === '=') {\n        params.category = where.value;\n      }\n      if (where.field === 'price' && where.operator === '>=') {\n        params.price_min = where.value;\n      }\n      if (where.field === 'price' && where.operator === '<=') {\n        params.price_max = where.value;\n      }\n    }\n\n    if (orderField && direction) {\n      params.sort = `${orderField}_${direction}`;\n    }\n\n    if (limit) {\n      params.per_page = limit;\n    }\n\n    return params;\n  }\n\n  // Logging utility\n  private log(message: string, data?: any): void {\n    if (this.config.enableLogging) {\n      console.log(`[StorefrontSDK] ${message}`, data || '');\n    }\n  }\n\n  /**\n   * Get SDK information\n   */\n  getInfo(): {\n    version: string;\n    environment: typeof Environment.info;\n    config: Omit<StorefrontConfig, 'secretKey'>;\n  } {\n    return {\n      version: this.config.version,\n      environment: Environment.info,\n      config: {\n        apiUrl: this.config.apiUrl,\n        publicKey: this.config.publicKey,\n        environment: this.config.environment,\n        timeout: this.config.timeout,\n        maxRetries: this.config.maxRetries,\n        enableLogging: this.config.enableLogging\n      }\n    };\n  }\n\n  /**\n   * Health check\n   */\n  async healthCheck(): Promise<{ status: 'ok' | 'error'; message?: string }> {\n    try {\n      await this.http.get('/health');\n      return { status: 'ok' };\n    } catch (error) {\n      return {\n        status: 'error',\n        message: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }\n}\n\n/**\n * Factory function for easy initialization\n */\nexport function createStorefrontSDK(config: StorefrontConfig): SecureStorefrontSDK {\n  return SecureStorefrontSDK.createInstance(config);\n}\n\n/**\n * Framework-specific helpers\n */\n\n// React Hook (if React is available)\nexport function useStorefrontSDK(config: StorefrontConfig) {\n  if (typeof globalThis !== 'undefined' && (globalThis as any).window && (globalThis as any).window.React) {\n    const React = (globalThis as any).window.React;\n    return React.useMemo(() => createStorefrontSDK(config), [\n      config.apiUrl,\n      config.publicKey,\n      config.environment\n    ]);\n  }\n  return createStorefrontSDK(config);\n}\n\n// Vue composable (if Vue is available)\nexport function useStorefront(config: StorefrontConfig) {\n  if (typeof globalThis !== 'undefined' && (globalThis as any).window && (globalThis as any).window.Vue) {\n    const Vue = (globalThis as any).window.Vue;\n    return Vue.computed(() => createStorefrontSDK(config));\n  }\n  return createStorefrontSDK(config);\n}\n\n// Export default for convenience\nexport default SecureStorefrontSDK;\n"],"mappings":"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","names":["Environment","isBrowser","isWebWorker","isNode","isServer","platform","key","__require","SecurityManager","config","token","Environment","timestamp","method","path","body","crypto","payload","hmac","signature","now","requestTime","expectedSignature","headers","error","input","bodyHash","data","key","a","b","result","i","item","sanitized","sensitiveFields","allowedTokens","value","keyLower","isAllowedToken","allowedToken","field","length","array","byte","response","UniversalHttpClient","config","security","request","url","body","authHeaders","headers","Environment","lastError","attempt","response","error","retryDelay","retryAfter","retryAfterMs","timeout","controller","timeoutId","fetchOptions","responseData","httpClient","axios","contentType","result","value","key","path","baseUrl","cleanPath","status","err","ms","resolve","params","requestUrl","searchParams","queryString","data","_SecureStorefrontSDK","config","SecurityManager","UniversalHttpClient","Environment","token","key","params","response","currency","field","operator","value","orderField","direction","count","id","slug","query","options","limit","productId","responseData","quantity","itemId","code","phone","countryCode","otp","sessionToken","requestBody","data","orderId","reviewData","sessionId","url","courseId","moduleId","tokenId","where","message","error","SecureStorefrontSDK","createStorefrontSDK","useStorefrontSDK","useStorefront","secure_storefront_sdk_default"]}